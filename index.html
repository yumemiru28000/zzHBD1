<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãƒ¯ã‚¤ãƒ³ï¿½ï¿½ãƒ©ãƒ¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆQRiousï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
  <style>
    :root {
      --bg-gradient-top: #020617;
      --bg-gradient-bottom: #02010a;
      --accent-blue: #3b82f6;
      --accent-blue-soft: #1e3a8a;
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --text-weak: #6b7280;
      --card-bg: rgba(15, 23, 42, 0.85);
      --overlay-bg: rgba(15, 23, 42, 0.8);
      --transition-standard: cubic-bezier(0.4, 0.0, 0.2, 1);
      --transition-soft: cubic-bezier(0.25, 0.1, 0.25, 1);
      --bottle-breath-duration: 8s;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Hiragino Sans", "Noto Sans JP", sans-serif;
      color: var(--text-main);
      background: radial-gradient(circle at top, #020617 0%, #02010a 55%, #000 100%);
    }

    body {
      overflow: hidden;
    }

    .app-root {
      position: relative;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 20% 0%, #0b1120 0%, #020617 30%, #000 100%);
      display: flex;
      align-items: stretch;
      justify-content: center;
      color: var(--text-main);
      isolation: isolate;
      overflow: hidden;
      animation: appFadeIn 1.0s var(--transition-standard) forwards;
      opacity: 0;
    }

    @keyframes appFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .grain-layer {
      position: absolute;
      inset: -40px;
      pointer-events: none;
      opacity: 0.06;
      mix-blend-mode: soft-light;
      background-image:
        radial-gradient(circle at 1px 1px, rgba(255,255,255,0.25) 0, transparent 1px);
      background-size: 3px 3px;
      z-index: 1;
    }

    .content-frame {
      position: relative;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 16px 24px;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: center;
      z-index: 2;
    }

    @media (min-width: 768px) {
      .content-frame {
        padding: 48px 40px 32px;
      }
    }

    .screen {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      transition:
        opacity 0.6s var(--transition-standard),
        transform 0.6s var(--transition-standard),
        visibility 0.6s var(--transition-standard);
    }

    .screen--hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transform: translateY(10px);
    }

    .screen--active {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
      transform: translateY(0);
    }

    .home-screen {
      align-items: center;
      justify-content: center;
    }

    .home-inner {
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 32px;
    }

    .brand-title {
      text-align: center;
      font-size: 18px;
      letter-spacing: 0.24em;
      text-transform: uppercase;
      color: var(--text-soft);
      margin-bottom: 12px;
      opacity: 0;
      transform: translateY(6px);
      animation: brandIntro 0.8s var(--transition-soft) 0.3s forwards;
    }

    .brand-subtitle {
      text-align: center;
      font-size: 13px;
      letter-spacing: 0.38em;
      text-transform: uppercase;
      color: var(--text-weak);
      opacity: 0;
      transform: translateY(6px);
      animation: brandIntro 0.9s var(--transition-soft) 0.6s forwards;
    }

    @keyframes brandIntro {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (min-width: 768px) {
      .brand-title {
        font-size: 20px;
      }
      .brand-subtitle {
        font-size: 12px;
      }
    }

    .bottle-strip-wrapper {
      width: 100%;
      padding: 32px 0 16px;
      overflow: hidden;
    }

    .bottle-strip {
      position: relative;
      width: 100%;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      gap: min(8%, 40px);
      transform: translateY(16px);
      opacity: 0;
      animation: bottlesIntro 0.8s var(--transition-standard) 0.8s forwards;
    }

    @keyframes bottlesIntro {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .bottle-item {
      position: relative;
      flex: 0 0 24%;
      max-width: 160px;
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      transform-origin: bottom center;
      transition:
        transform 0.4s var(--transition-standard),
        filter 0.3s var(--transition-standard),
        opacity 0.3s var(--transition-standard);
      animation: bottleBreath var(--bottle-breath-duration) ease-in-out infinite;
    }

    @keyframes bottleBreath {
      0% { transform: scale(1); }
      45% { transform: scale(1.006); }
      100% { transform: scale(1); }
    }

    .bottle-item--dimmed {
      filter: brightness(0.9);
      opacity: 0.8;
    }

    .bottle-item--focused {
      filter: brightness(1.05);
      transform: translateY(-4px) scale(1.03);
    }

    .bottle-item--side {
      opacity: 0.4;
      filter: grayscale(0.1) brightness(0.75);
      transform: scale(0.9);
    }

    .bottle-image-wrapper {
      position: relative;
      width: 100%;
      display: flex;
      align-items: flex-end;
      justify-content: center;
    }

    .bottle-image {
      width: 100%;
      height: auto;
      object-fit: contain;
      display: block;
      image-rendering: -webkit-optimize-contrast;
      transition: filter 0.2s var(--transition-standard),
                  transform 0.2s var(--transition-standard);
    }

    .bottle-shadow {
      position: absolute;
      left: 50%;
      bottom: -10px;
      width: 80%;
      max-width: 120px;
      height: 18px;
      background: radial-gradient(
        ellipse at center,
        rgba(0,0,0,0.18) 0%,
        rgba(0,0,0,0.0) 60%
      );
      transform: translateX(-50%);
      filter: blur(8px);
      opacity: 0;
      animation: shadowIntro 0.6s var(--transition-standard) 1.0s forwards;
    }

    @keyframes shadowIntro {
      from { opacity: 0; transform: translateX(-50%) translateY(4px); }
      to   { opacity: 1; transform: translateX(-50%) translateY(0); }
    }

    .bottle-reflection {
      position: absolute;
      left: 50%;
      bottom: -16px;
      width: 40%;
      max-width: 64px;
      height: 14px;
      background: radial-gradient(
        ellipse at center,
        rgba(148, 163, 184, 0.15) 0%,
        rgba(148, 163, 184, 0.0) 70%
      );
      transform: translateX(-50%) scaleY(0.6);
      filter: blur(12px);
      opacity: 0.5;
      pointer-events: none;
    }

    /* å³ä¸‹ï¼šQRãƒœã‚¿ãƒ³ï¼ˆQRã£ã½ãï¼‰ */
    .home-floating-dots {
      position: absolute;
      right: 18px;
      bottom: 18px;
      width: 32px;
      height: 32px;
      border-radius: 10px;
      background:
        radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.6) 0%, transparent 45%),
        linear-gradient(135deg, #020617, #020617);
      box-shadow:
        0 0 0 1px rgba(15,23,42,0.9),
        0 8px 18px rgba(15,23,42,0.8);
      cursor: pointer;
      opacity: 0;
      transform: translateY(4px) scale(0.9);
      animation: dotButtonIntro 0.6s var(--transition-standard) 1.0s forwards;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @keyframes dotButtonIntro {
      from { opacity: 0; transform: translateY(8px) scale(0.85); }
      to   { opacity: 1; transform: translateY(0) scale(1); }
    }

    .home-floating-dots::before {
      content: "";
      position: absolute;
      inset: -8px;
      border-radius: inherit;
      border: 1px solid rgba(148,163,184,0.18);
      pointer-events: none;
    }

    .home-floating-dots:hover {
      box-shadow:
        0 0 0 1px rgba(37,99,235,0.9),
        0 12px 26px rgba(56,189,248,0.45);
    }

    /* ä¸­ã«ãƒŸãƒ‹QRãƒ‰ãƒƒãƒˆ */
    .home-floating-qr-inner {
      width: 18px;
      height: 18px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 2px;
    }

    .home-floating-qr-inner span {
      width: 4px;
      height: 4px;
      border-radius: 2px;
      background: rgba(148,163,184,0.4);
    }

    .home-floating-qr-inner span:nth-child(1),
    .home-floating-qr-inner span:nth-child(3),
    .home-floating-qr-inner span:nth-child(7) {
      background: #e5e7eb;
    }

    /* pager-dots ã¯ UIã‹ã‚‰æ¶ˆã™ï¼ˆè¦æœ›ï¼‰ */
    .pager-dots {
      display: none;
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: var(--overlay-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transition:
        opacity 0.4s var(--transition-standard),
        visibility 0.4s var(--transition-standard);
      z-index: 20;
    }

    .overlay--open {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }

    .overlay-inner {
      width: 100%;
      max-width: 720px;
      padding: 24px 16px 18px;
      background: radial-gradient(circle at top, rgba(15,23,42,0.96) 0%, rgba(2,6,23,0.98) 60%, rgba(15,23,42,0.98) 100%);
      border-radius: 20px;
      border: 1px solid rgba(148,163,184,0.18);
      box-shadow:
        0 22px 60px rgba(15,23,42,0.85),
        0 0 0 1px rgba(15,23,42,1);
      transform: translateY(8px);
      opacity: 0;
      transition:
        opacity 0.5s var(--transition-standard),
        transform 0.5s var(--transition-standard);
    }

    .overlay--open .overlay-inner {
      opacity: 1;
      transform: translateY(0);
    }

    .overlay-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      gap: 8px;
    }
    .overlay-title {
      font-size: 14px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--text-soft);
    }
    .overlay-close {
      cursor: pointer;
      font-size: 12px;
      color: var(--text-weak);
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.6);
      border: 1px solid rgba(148,163,184,0.25);
      transition:
        background 0.2s var(--transition-standard),
        color 0.2s var(--transition-standard),
        border-color 0.2s var(--transition-standard);
    }
    .overlay-close:hover {
      background: rgba(55,65,81,0.7);
      color: var(--text-main);
      border-color: rgba(156,163,175,0.8);
    }

    .overlay-bottle-list {
      display: flex;
      flex-wrap: wrap;
      gap: 18px;
      padding: 10px 4px 4px;
      max-height: 360px;
      overflow-y: auto;
      scrollbar-width: thin;
    }

    .overlay-bottle {
      position: relative;
      flex: 0 0 160px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      padding: 8px 8px 10px;
      border-radius: 16px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(31,41,55,0.9);
    }
    .overlay-bottle-img-wrap {
      position: relative;
      width: 70px;
      height: 140px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
    }
    .overlay-bottle-img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
    .overlay-bottle-shadow {
      position: absolute;
      left: 50%;
      bottom: -8px;
      width: 70%;
      height: 14px;
      transform: translateX(-50%);
      background: radial-gradient(
        ellipse at center,
        rgba(15,23,42,0.55) 0%,
        rgba(15,23,42,0) 60%
      );
      filter: blur(6px);
      opacity: 0.9;
    }

    .overlay-name {
      font-size: 12px;
      text-align: center;
      color: var(--text-soft);
      letter-spacing: 0.08em;
    }

    .overlay-qr-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      margin-top: 4px;
    }

    .overlay-qr-canvas-wrap {
      width: 96px;
      height: 96px;
      padding: 4px;
      border-radius: 14px;
      background: radial-gradient(circle at 30% 0, rgba(15,23,42,0.9), rgba(2,6,23,1));
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .overlay-qr-action-row {
      display: flex;
      gap: 6px;
      margin-top: 4px;
    }

    .overlay-qr-icon {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: var(--text-soft);
      cursor: pointer;
      background: rgba(15,23,42,0.9);
      backdrop-filter: blur(8px);
      transition:
        background 0.2s var(--transition-standard),
        border-color 0.2s var(--transition-standard),
        color 0.2s var(--transition-standard),
        transform 0.25s var(--transition-standard);
    }
    .overlay-qr-icon:hover {
      border-color: #60a5fa;
      color: #bfdbfe;
      background: rgba(15,23,42,0.95);
      transform: translateY(-1px);
    }

    .overlay-footer-note {
      margin-top: 10px;
      font-size: 11px;
      color: var(--text-weak);
      text-align: right;
    }

    /* wineXp */

    .winexp-screen {
      padding: 32px 16px 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    @media (min-width: 768px) {
      .winexp-screen {
        padding: 40px 36px 24px;
      }
    }

    .winexp-bg-layer {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: -1;
      opacity: 0.96;
      background:
        radial-gradient(circle at 10% -10%, #1e293b 0%, transparent 40%),
        radial-gradient(circle at 100% 0%, #020617 0%, transparent 55%),
        radial-gradient(circle at 50% 100%, #020617 0%, #000 60%);
      transition:
        filter 0.65s var(--transition-soft),
        background 0.65s var(--transition-soft);
    }

    .night-stars {
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0;
      transition: opacity 1.2s var(--transition-soft);
      background-image:
        radial-gradient(circle at 10% 20%, rgba(248,250,252,0.65) 0, transparent 1px),
        radial-gradient(circle at 70% 40%, rgba(248,250,252,0.9) 0, transparent 1px),
        radial-gradient(circle at 30% 70%, rgba(248,250,252,0.75) 0, transparent 1px),
        radial-gradient(circle at 80% 80%, rgba(248,250,252,0.45) 0, transparent 1px);
      background-size: 260px 260px;
      mix-blend-mode: screen;
    }

    .night-stars--visible {
      opacity: 0.6;
      animation: starDrift 18s linear infinite alternate;
    }

    @keyframes starDrift {
      from { transform: translate3d(0, 0, 0); }
      to   { transform: translate3d(-10px, -12px, 0); }
    }

    .winexp-header-space {
      min-height: 32vh;
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 0.9fr);
      gap: 24px;
      padding-top: 16px;
      align-items: center;
    }

    @media (max-width: 768px) {
      .winexp-header-space {
        grid-template-columns: 1fr;
      }
    }

    .winexp-label {
      font-size: 11px;
      letter-spacing: 0.35em;
      text-transform: uppercase;
      color: var(--text-weak);
      margin-bottom: 14px;
    }

    .winexp-title-jp {
      font-size: 28px;
      letter-spacing: 0.08em;
      margin-bottom: 6px;
      opacity: 0;
      transform: scale(1.02) translateY(4px);
      animation: winexpTitleIn 1.1s ease-out forwards;
      animation-delay: 0.9s;
    }

    @keyframes winexpTitleIn {
      from { opacity: 0; transform: scale(1.02) translateY(4px); }
      to   { opacity: 1; transform: scale(1) translateY(0); }
    }

    .winexp-title-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .title-paw {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, #facc15 0%, #eab308 40%, #7c2d12 100%);
      color: #111827;
      font-size: 13px;
      cursor: pointer;
      box-shadow:
        0 0 0 1px rgba(15,23,42,0.9),
        0 8px 18px rgba(15,23,42,0.9);
      transition:
        transform 0.2s var(--transition-standard),
        box-shadow 0.2s var(--transition-standard);
    }

    .title-paw:hover {
      transform: translateY(-1px) scale(1.05);
      box-shadow:
        0 0 0 1px rgba(251,191,36,0.9),
        0 10px 24px rgba(15,23,42,1);
    }

    .winexp-title-en {
      font-size: 12px;
      letter-spacing: 0.25em;
      text-transform: uppercase;
      color: var(--text-soft);
      opacity: 0;
      transform: translateY(5px);
      animation: winexpSubtitleIn 0.9s var(--transition-standard) forwards;
      animation-delay: 1.3s;
    }

    @keyframes winexpSubtitleIn {
      from { opacity: 0; transform: translateY(5px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .winexp-tagline {
      margin-top: 16px;
      font-size: 12px;
      color: var(--text-soft);
      letter-spacing: 0.1em;
      text-transform: uppercase;
      opacity: 0;
      transform: translateY(8px);
      animation: winexpTaglineIn 0.9s var(--transition-standard) forwards;
      animation-delay: 1.7s;
    }

    @keyframes winexpTaglineIn {
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* ãƒ¯ã‚¤ãƒ³åã®å¹ãå‡ºã—ï¼ˆtaglineç”¨ï¼‰ */
    .wine-title-bubble {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 12px;
      padding: 4px 10px 5px;
      border-radius: 999px;
      background: rgba(15,23,42,0.8);
      border: 1px solid rgba(55,65,81,0.9);
      box-shadow:
        0 0 0 1px rgba(15,23,42,0.9),
        0 10px 24px rgba(15,23,42,0.9);
      font-size: 10px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--text-soft);
      position: relative;
      opacity: 0;
      transform: translateY(8px);
      animation: wineBubbleIn 0.9s var(--transition-standard) forwards;
      animation-delay: 1.9s;
    }

    .wine-title-bubble::before {
      content: "";
      position: absolute;
      left: 20px;
      top: -5px;
      width: 8px;
      height: 5px;
      background: rgba(15,23,42,0.8);
      border-left: 1px solid rgba(55,65,81,0.9);
      border-top: 1px solid rgba(55,65,81,0.9);
      transform: rotate(45deg);
    }

    @keyframes wineBubbleIn {
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼å³ï¼šãƒœãƒˆãƒ«ã®å¤§ãã‚ç”»åƒ */
    .winexp-bottle-hero {
      justify-self: center;
      align-self: center;
      width: min(220px, 70%);
      max-height: 320px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      position: relative;
      opacity: 0;
      transform: translateY(12px) scale(0.96);
      animation: heroBottleIn 0.9s var(--transition-soft) forwards;
      animation-delay: 0.9s;
    }

    @keyframes heroBottleIn {
      from { opacity: 0; transform: translateY(16px) scale(0.95); }
      to   { opacity: 1; transform: translateY(0) scale(1); }
    }

    .winexp-bottle-hero img {
      width: 100%;
      height: auto;
      object-fit: contain;
      filter: drop-shadow(0 22px 40px rgba(15,23,42,0.9));
    }

    .winexp-bottle-hero-shadow {
      position: absolute;
      left: 50%;
      bottom: -14px;
      width: 80%;
      height: 24px;
      transform: translateX(-50%);
      background: radial-gradient(
        ellipse at center,
        rgba(15,23,42,0.7) 0%,
        rgba(15,23,42,0) 65%
      );
      filter: blur(10px);
    }

    .winexp-screen--locked-interaction {
      pointer-events: none;
    }

    .winexp-section {
      margin-top: 36px;
      position: relative;
      overflow: hidden;
    }

    .winexp-section::before {
      content: "";
      position: absolute;
      right: -5%;
      top: 10%;
      width: 40%;
      height: 80%;
      background-repeat: no-repeat;
      background-position: center right;
      background-size: contain;
      opacity: 0.12;
      pointer-events: none;
      filter: blur(1px);
      transition: opacity 0.6s var(--transition-soft), background-image 0.3s ease-out;
    }

    .winexp-section--has-image::before {
      opacity: 0.18;
    }

    .info-block {
      margin-bottom: 18px;
      opacity: 0;
      transform: translateY(12px);
      transition:
        opacity 0.6s var(--transition-standard),
        transform 0.6s var(--transition-standard);
    }

    .info-block--visible {
      opacity: 1;
      transform: translateY(0);
    }

    .info-label {
      font-size: 11px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--text-weak);
      margin-bottom: 6px;
    }

    .info-value {
      font-size: 15px;
      letter-spacing: 0.06em;
      color: var(--text-main);
    }

    .world-section {
      margin-top: 44px;
      padding: 32px 18px 30px;
      border-radius: 22px;
      background: radial-gradient(circle at top, rgba(15,23,42,0.96) 0%, rgba(2,6,23,0.96) 45%, rgba(2,6,23,0.98) 100%);
      border: 1px solid rgba(51,65,85,0.7);
      box-shadow:
        0 24px 60px rgba(15,23,42,0.85),
        0 0 0 1px rgba(15,23,42,0.9);
      position: relative;
      overflow: hidden;
    }

    .world-section::before {
      content: "";
      position: absolute;
      inset: -30%;
      background:
        radial-gradient(circle at 20% 0%, rgba(59,130,246,0.16) 0%, transparent 60%),
        radial-gradient(circle at 60% 100%, rgba(30,64,175,0.14) 0%, transparent 60%);
      mix-blend-mode: screen;
      opacity: 0;
      transition: opacity 0.6s var(--transition-standard);
    }

    .world-section--active::before {
      opacity: 1;
    }

    .world-meta-label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 2px 8px 3px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(55,65,81,0.7);
      font-size: 10px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--text-soft);
      margin-bottom: 10px;
    }

    .world-block {
      margin-bottom: 18px;
    }

    .world-line-primary,
    .world-line-secondary {
      text-align: center;
      font-size: 15px;
      letter-spacing: 0.1em;
      color: var(--text-main);
      opacity: 0;
      transform: translateY(8px);
      transition:
        opacity 0.9s var(--transition-soft),
        transform 0.9s var(--transition-soft);
    }

    .world-line-primary {
      margin-bottom: 18px;
    }

    .world-line-secondary {
      font-size: 14px;
      color: var(--text-soft);
    }

    .world-line-primary--visible,
    .world-line-secondary--visible {
      opacity: 1;
      transform: translateY(0);
    }

    .message-section {
      margin-top: 44px;
    }

    .message-wax {
      width: 72px;
      height: 72px;
      border-radius: 999px;
      margin: 0 auto 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      background:
        radial-gradient(circle at 20% 10%, #1d4ed8 0%, #1e40af 45%, #020617 100%);
      box-shadow:
        0 0 0 1px rgba(15,23,42,0.9),
        0 12px 25px rgba(15,23,42,0.9),
        0 0 22px rgba(37,99,235,0.5);
      color: #e5e7eb;
      font-size: 11px;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      cursor: pointer;
      opacity: 0;
      transform: scale(0.92) translateY(4px);
      transition:
        opacity 0.6s var(--transition-standard),
        transform 1.2s var(--transition-soft),
        box-shadow 0.4s var(--transition-standard);
    }

    .message-wax--visible {
      opacity: 1;
      transform: scale(1) translateY(0);
    }

    .message-wax:hover {
      box-shadow:
        0 0 0 1px rgba(96,165,250,0.9),
        0 20px 40px rgba(15,23,42,1),
        0 0 32px rgba(96,165,250,0.7);
    }

    /* æ‰‹ç´™ã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ */
    .message-card {
      max-width: 520px;
      margin: 0 auto;
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,0.45);
      background:
        linear-gradient(135deg, rgba(17,24,39,0.97), rgba(15,23,42,0.99));
      box-shadow:
        0 24px 60px rgba(15,23,42,0.9),
        0 0 0 1px rgba(15,23,42,0.96);
      padding: 0 22px;
      overflow: hidden;
      transform-origin: top center;
      transform: scaleY(0.85);
      max-height: 0;
      opacity: 0;
      transition:
        transform 0.8s var(--transition-soft),
        max-height 0.8s var(--transition-soft),
        opacity 0.8s var(--transition-soft),
        padding-top 0.8s var(--transition-soft),
        padding-bottom 0.8s var(--transition-soft),
        margin-top 0.8s var(--transition-soft);
      position: relative;
    }

    .message-card::before {
      content: "";
      position: absolute;
      inset: 12px 16px auto 16px;
      height: 1px;
      background: linear-gradient(to right, rgba(55,65,81,0.7), rgba(31,41,55,0.1));
      opacity: 0.7;
    }

    .message-card--open {
      transform: scaleY(1);
      max-height: 520px;
      opacity: 1;
      padding-top: 26px;
      padding-bottom: 24px;
      margin-top: 6px;
    }

    .message-header-label {
      font-size: 10px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--text-weak);
      margin-bottom: 10px;
    }

    .message-body {
      padding-top: 8px;
    }

    .message-line {
      font-size: 14px;
      color: var(--text-main);
      line-height: 1.9;
      opacity: 0;
      transform: translateY(4px);
    }

    .message-line + .message-line {
      margin-top: 4px;
    }

    .message-line--visible {
      opacity: 1;
      transform: translateY(0);
      transition:
        opacity 0.4s var(--transition-standard),
        transform 0.4s var(--transition-standard);
    }

    .accordion-list {
      margin-top: 44px;
      border-top: 1px solid rgba(55,65,81,0.7);
    }

    .accordion-item {
      border-bottom: 1px solid rgba(55,65,81,0.7);
    }

    .accordion-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 4px;
      cursor: pointer;
      gap: 12px;
    }

    .accordion-label-wrap {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .accordion-icon {
      font-size: 16px;
    }

    .accordion-title {
      font-size: 14px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--text-soft);
    }

    .accordion-arrow {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(75,85,99,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: var(--text-weak);
      transition:
        transform 0.3s var(--transition-standard),
        background 0.3s var(--transition-standard),
        color 0.3s var(--transition-standard);
    }

    .accordion-item--open .accordion-arrow {
      transform: rotate(90deg);
      background: rgba(31,41,55,0.9);
      color: var(--text-main);
    }

    .accordion-body {
      max-height: 0;
      overflow: hidden;
      padding: 0 4px;
      transition:
        max-height 0.4s var(--transition-standard),
        padding-bottom 0.4s var(--transition-standard);
    }

    .accordion-item--open .accordion-body {
      padding-bottom: 12px;
      max-height: 260px;
    }

    .accordion-text {
      font-size: 13px;
      color: var(--text-main);
      line-height: 1.8;
      white-space: pre-line;
    }

    .home-button {
      position: fixed;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(75,85,99,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 18;
      opacity: 0;
      pointer-events: none;
      transition:
        opacity 0.25s var(--transition-standard),
        transform 0.25s var(--transition-standard),
        background 0.25s var(--transition-standard),
        border-color 0.25s var(--transition-standard);
    }

    .home-button--visible {
      opacity: 1;
      pointer-events: auto;
    }

    .home-button:hover {
      background: rgba(31,41,55,0.98);
      border-color: rgba(148,163,184,0.95);
      transform: translateY(-50%) scale(1.04);
    }

    /* å®¶ã‚¢ã‚¤ã‚³ãƒ³ */
    .home-button-icon {
      position: relative;
      width: 14px;
      height: 12px;
      border-radius: 2px;
      border: 1px solid rgba(209,213,219,0.9);
      background: rgba(15,23,42,1);
      box-shadow: inset 0 0 0 1px rgba(15,23,42,1);
    }
    .home-button-icon::before {
      content: "";
      position: absolute;
      left: 50%;
      bottom: 100%;
      width: 16px;
      height: 10px;
      border-left: 1px solid rgba(209,213,219,0.9);
      border-top: 1px solid rgba(209,213,219,0.9);
      border-right: 1px solid rgba(209,213,219,0.9);
      border-radius: 3px 3px 0 0;
      transform: translateX(-50%) translateY(2px) rotate(45deg);
      background: rgba(15,23,42,1);
    }

    .revisit-badge {
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%) translateY(12px);
      padding: 4px 12px 5px;
      border-radius: 999px;
      background: radial-gradient(circle at 0 0, rgba(59,130,246,0.75) 0%, rgba(2,6,23,0.98) 35%);
      border: 1px solid rgba(59,130,246,0.5);
      color: #e5e7eb;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      opacity: 0;
      pointer-events: none;
      box-shadow:
        0 0 0 1px rgba(15,23,42,0.9),
        0 10px 30px rgba(15,23,42,0.9);
      z-index: 17;
      white-space: nowrap;
    }

    .revisit-badge--visible {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
      transition:
        opacity 0.8s var(--transition-standard),
        transform 0.8s var(--transition-standard);
    }

    .revisit-star {
      font-size: 12px;
    }

    .revisit-text {
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    @media (max-width: 480px) {
      .revisit-badge {
        font-size: 10px;
      }
    }

    .audio-control {
      position: fixed;
      left: 16px;
      bottom: 16px;
      padding: 6px 10px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.85);
      border: 1px solid rgba(51,65,85,0.9);
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--text-soft);
      backdrop-filter: blur(14px);
      box-shadow:
        0 0 0 1px rgba(15,23,42,0.9),
        0 10px 30px rgba(15,23,42,0.9);
      z-index: 19;
    }

    .audio-label {
      letter-spacing: 0.18em;
      text-transform: uppercase;
    }

    .audio-icon {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, #60a5fa 0%, #1d4ed8 40%, #020617 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: #e5e7eb;
    }

    .audio-slider {
      appearance: none;
      width: 90px;
      height: 3px;
      background: rgba(55,65,81,0.9);
      border-radius: 999px;
      outline: none;
      cursor: pointer;
    }

    .audio-slider::-webkit-slider-thumb {
      appearance: none;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #60a5fa;
      box-shadow: 0 0 0 3px rgba(37,99,235,0.4);
      border: 1px solid rgba(191,219,254,0.9);
      margin-top: -4.5px;
    }
    .audio-slider::-moz-range-thumb {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #60a5fa;
      border: 1px solid rgba(191,219,254,0.9);
    }
  </style>
</head>
<body>
  <div class="app-root">
    <div class="grain-layer"></div>

    <div class="screen home-screen screen--active" id="home-screen">
      <div class="content-frame">
        <div class="home-inner">
          <header>
            <div class="brand-title">YUMEMIRU VINEYARD</div>
            <div class="brand-subtitle">ISLAND BOTTLE ARCHIVES</div>
          </header>

          <section class="bottle-strip-wrapper">
            <div class="bottle-strip" id="bottle-strip"></div>
            <div class="pager-dots" id="pager-dots"></div>
          </section>
        </div>
      </div>

      <!-- å³ä¸‹ï¼šQR -->
      <div class="home-floating-dots" id="qr-toggle">
        <div class="home-floating-qr-inner">
          <span></span><span></span><span></span>
          <span></span><span></span><span></span>
          <span></span><span></span><span></span>
        </div>
      </div>
    </div>

    <div class="screen winexp-screen screen--hidden" id="winexp-screen">
      <div class="winexp-bg-layer" id="winexp-bg-layer"></div>
      <div class="night-stars" id="night-stars"></div>

      <div class="content-frame winexp-content">
        <div class="winexp-header-space">
          <div>
            <div class="winexp-label">Wine</div>
            <div class="winexp-title-row">
              <div class="winexp-title-jp" id="winexp-title-jp"></div>
              <!-- è‚‰çƒã¯ JS ã§ wine4 ã®ã¨ãã ã‘å·®ã—è¾¼ã‚€ -->
              <button class="title-paw" id="paw-button" style="display:none;">ğŸ¾</button>
            </div>
            <div class="winexp-title-en" id="winexp-title-en"></div>
            <div class="wine-title-bubble" id="wine-title-bubble" style="display:none;">
              <span>Tagline</span>
              <span id="wine-title-bubble-text"></span>
            </div>
          </div>

          <div class="winexp-bottle-hero" id="winexp-bottle-hero" style="display:none;">
            <img id="winexp-bottle-hero-img" src="" alt="">
            <div class="winexp-bottle-hero-shadow"></div>
          </div>
        </div>

        <section class="winexp-section" id="basic-info-section"></section>

        <section class="world-section" id="world-section">
          <div class="world-block">
            <div class="world-meta-label">Effect</div>
            <div class="world-line-primary" id="world-line-primary"></div>
          </div>
          <div class="world-block">
            <div class="world-meta-label">Message</div>
            <div class="world-line-secondary" id="world-line-secondary"></div>
          </div>
        </section>

        <section class="message-section">
          <div class="message-wax" id="message-wax">Message</div>
          <div class="message-card" id="message-card">
            <div class="message-header-label">Letter from the Island</div>
            <div class="message-body" id="message-body"></div>
          </div>
        </section>

        <section class="accordion-list" id="accordion-list"></section>
      </div>
    </div>

    <div class="home-button" id="home-button">
      <div class="home-button-icon"></div>
    </div>

    <div class="revisit-badge" id="revisit-badge">
      <span class="revisit-star">â˜…</span>
      <span class="revisit-text" id="revisit-text">SECOND POUR</span>
    </div>

    <div class="overlay" id="qr-overlay">
      <div class="overlay-inner">
        <div class="overlay-header">
          <div class="overlay-title">Bottle Index</div>
          <div class="overlay-close" id="qr-close">Close</div>
        </div>
        <div class="overlay-bottle-list" id="overlay-bottle-list"></div>
        <div class="overlay-footer-note">
          Tap QR to preview / Save to download the image.
        </div>
      </div>
    </div>

    <div class="audio-control">
      <div class="audio-icon">â™ª</div>
      <div class="audio-label">Ambient</div>
      <input
        type="range"
        min="0"
        max="1"
        step="0.01"
        value="0.5"
        class="audio-slider"
        id="bgm-volume"
      />
    </div>
  </div>

  <!-- BGM ã¨ SEï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã¯ index.html ã¨åŒã˜å ´æ‰€ã«ç½®ãï¼‰ -->
  <audio id="bgm-audio" src="Somehow.mp3" loop></audio>
  <audio id="se-wine1" src="s1.mp3"></audio>
  <audio id="nya-audio" src="nya.mp3"></audio>

  <script>
    const BASE_URL = "https://yumemiru28000.github.io/zzHBD1/index.html";

    const wines = [
      {
        id: "wine1",
        bottleImage: "https://raw.githubusercontent.com/yumemiru28000/zzHBD1/main/wine1.png",
        qrImage: "",
        q1_name: "é’ã®å®‰ã‚‰ã",
        q2_producer: "ãƒ¦ãƒ¡ãƒŸã‚‹ãƒ¯ã‚¤ãƒŠãƒªãƒ¼",
        q3_origin: "ã‚ºã‚ºã«ã‚ƒã‚“å³¶",
        q4_variety: "ã‚ºã‚ºã«ã‚ƒã‚“å³¶ç”£ã¶ã©ã†",
        q5_vintage: "2026",
        q6_style: "Signature", // Rankã«å¤‰ãˆã‚‹ã®ã§ä¸­èº«ã¯ãã®ã¾ã¾
        q7_alcohol: "12.5%",

        q8_world_phrase: "ç©ã‚„ã‹ãªæ³¢ã®ã‚ˆã†ãªå®‰å¯§",
        q9_world_line: "é™ã‘ã•ã¨å®‰ã‚‰ãã‚’ã‚ãªãŸã«",

        q10_message_lines: [
          "ãŠèª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼",
          "ç´ æ•µãª1å¹´ã«ãªã‚Šã¾ã™ã‚ˆã†ã«âœ¨",
          "ãã—ã¦ã€ãŠã„ã—ã„ãŠé…’ã«å·¡ã‚Šã‚ãˆã¾ã™ã‚ˆã†ã«ğŸ·"
        ],

        q11_pairing: "ãªã‚“ã§ã‚‚",
        q12_storage: "ã‚ãªãŸã«ã¨ã£ã¦å¤§åˆ‡ãªå ´æ‰€",
        q13_craft: "æ³¢ã®ç©ã‚„ã‹ãªæµ·ã§æµ·åº•ç†Ÿæˆã•ã›ãŸã‚‚ã®",

        display_en: "CALM OF BLUE",
        tagline: "ISLAND NIGHT SELECTION",
        openCount: 0
      },
      {
        id: "wine2",
        bottleImage: "https://raw.githubusercontent.com/yumemiru28000/zzHBD1/main/wine1.png",
        qrImage: "",
        q1_name: "Orseille Rose Wine",
        q2_producer: "æ˜Ÿãƒãƒ¯ã‚¤ãƒŠãƒªãƒ¼",
        q3_origin: "æ—¥æœ¬",
        q4_variety: "æ˜Ÿãƒãƒ‘ãƒ¼ãƒ—ãƒ«",
        q5_vintage: "1980",
        q6_style: "Signature",
        q7_alcohol: "12.0%",

        q8_world_phrase: "æ°—åˆ†ä¸Šã€…",
        q9_world_line: "æ¥½ã—ã„æ™‚é–“ã‚’å…±ã«",

        q10_message_lines: [
          "ãŠèª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼"
        ],

        q11_pairing: "ã‚¤ã‚¿ãƒªã‚¢ãƒ³",
        q12_storage: "æ¶¼ã—ãã¦æš—ã„ã¨ã“ã‚",
        q13_craft: "è·äººãŒä¸å¯§ã«ä½œã‚Šã¾ã—ãŸ",

        display_en: "ROSE MOMENT",
        tagline: "A PERFECT MATCH WITH ITALIAN CUISINE",
        openCount: 0
      },
      {
        id: "wine3",
        bottleImage: "https://raw.githubusercontent.com/yumemiru28000/zzHBD1/main/wine1.png",
        qrImage: "",
        q1_name: "è’¼æµ·ã®çœ ã‚Š",
        q2_producer: "ç€¬æˆ¸å†…ãƒ»ä¿¡é•·ã‚¢ãƒãƒé†¸é€ æ‰€",
        q3_origin: "æ—¥æœ¬ãƒ»ç€¬æˆ¸å†…æµ·æ²–",
        q4_variety: "ç”²å·ç¨® 100%ã€ã‚·ãƒ£ãƒ«ãƒ‰ãƒãƒ–ãƒ¬ãƒ³ãƒ‰",
        q5_vintage: "2020",
        q6_style: "Premium",
        q7_alcohol: "12.0%",

        q8_world_phrase: "è’ç«‹ã£ãŸå¿ƒã‚’é®ã‚ã€æ·±æµ·ã«æŠ±ã‹ã‚Œã¦ã„ã‚‹ã‚ˆã†ãªæ·±ã„å®‰ã‚‰ãã¨çœ ã‚Šã‚’ã‚‚ãŸã‚‰ã™ã€‚",
        q9_world_line: "ã€Œæ³¢ã®ã‚†ã‚‰ããŒè‚²ã¦ãŸã€æ·±æµ·ã®ã‚¢ãƒ¼ãƒˆãƒ”ãƒ¼ã‚¹ã€‚ã€",

        q10_message_lines: [
          "ã¾ã‚‹ã§æµ·åº•ã§ç†Ÿæˆã•ã‚ŒãŸãƒ¯ã‚¤ãƒ³ã®ã‚ˆã†ã«ã€",
          "æ™‚ã¨ã„ã†æ³¢ã«æ‰ã¾ã‚Œã‚‹ã“ã¨ã§ã€",
          "ã‹ã¹ã‚‹ã­ãµã‚‰ã‚“ã•ã‚“ã®ä¸­ã§è‰¯ã„æ„å‘³ã§è§’ãŒå–ã‚Œã€",
          "ã‹ã‘ãŒãˆã®ãªã„äººé–“çš„ãªåšã¿ã‚„ã¾ã‚ã‚„ã‹ã•ãŒç”Ÿã¾ã‚Œã¦ã„ã‚‹ã®ã‚’æ„Ÿã˜ã¾ã™ã€‚",
          "å¹´é½¢ã¨ã¨ã‚‚ã«é‡ã­ã¦ã„ãçµŒé¨“ã®è·¡ã¯ã€",
          "ã¾ã•ã«è±Šã‹ãªäººç”Ÿã®æµ·ã‚’æ³³ã„ã§ããŸæ™‚é–“ã®è¨¼æ˜ã§ã™ã­ã€‚",
          "ãã‚“ãªç´ æ•µãªå¹´ã®é‡ã­æ–¹ã‚’ã•ã‚Œã¦ã„ã‚‹ã‹ã¹ã‚‹ã­ãµã‚‰ã‚“ã•ã‚“ã«ã€",
          "ãŠèª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã†ã€‚"
        ],

        q11_pairing: "ç”Ÿç‰¡è £ï¼ˆãƒ¬ãƒ¢ãƒ³æ·»ãˆï¼‰ã€ç™½èº«é­šã®æ˜†å¸ƒç· ã‚ã€ä¼Šå‹¢æµ·è€ã®ã‚°ãƒªãƒ«ã€‚",
        q12_storage: "ç›´å°„æ—¥å…‰ã‚’é¿ã‘ã€æš—ãé™ã‹ãªå ´æ‰€",
        q13_craft: "æµ·åº•ç†Ÿæˆ",

        display_en: "SILENCE OF THE DEEP",
        tagline: "PAIRING WITH OCEAN DELICACIES",
        openCount: 0
      },
      {
        id: "wine4",
        bottleImage: "https://raw.githubusercontent.com/yumemiru28000/zzHBD1/main/wine1.png",
        qrImage: "",
        q1_name: "Nyadal",
        q2_producer: "ã›ã´ã‚ã‚ã„ãªã‚Šãƒ¼",
        q3_origin: "ã‹ã«ã‚ƒã ",
        q4_variety: "Nyadal Blanc",
        q5_vintage: "2025",
        q6_style: "Premium",
        q7_alcohol: "12.5%",

        q8_world_phrase: "ã‚ã¾ãˆã­ã“ã«ãªã‚‹",
        q9_world_line: "ã­ã“ã«ãŠã™ã™ã‚ï¼",

        q10_message_lines: [
          "ã‹ã¹ã‚‹ã­ã•ã‚“ãŠèª•ç”Ÿæ—¥ãŠã‚ã§ã¨ï½ï½ï½â™¡â™¡â™¡â™¡â™¡"
        ],

        q11_pairing: "ã¡ãƒ¼ãšã¨ã‹ã‘ãƒ¼ã",
        q12_storage: "ã¤ã‚ãŸã„ã¯ã“ï¼",
        q13_craft: "ã­ã“ãŸã¡ãŒã“ãŠã£ãŸã¶ã©ã†ã‚’ã‚ã£ã•ãã—ã¾ã—ãŸï¼",

        display_en: "NYADAL SWEET TIME",
        tagline: "A GIFT FOR CAT LOVERS",
        openCount: 0
      },
      {
        id: "wine5",
        bottleImage: "https://raw.githubusercontent.com/yumemiru28000/zzHBD1/main/wine1.png",
        qrImage: "",
        q1_name: "ã™ã£ã”ãç¾å‘³ã—ã„ãƒ¯ã‚¤ãƒ³",
        q2_producer: "NEKOmata Vineyard",
        q3_origin: "Neko island",
        q4_variety: "æ˜Ÿã‚’å®¿ã™ãƒ¦ãƒ‹ãƒ»ãƒ–ãƒ©ãƒ³",
        q5_vintage: "1900",
        q6_style: "Casual Sip",
        q7_alcohol: "12.0%",

        q8_world_phrase: "ä¸–ç•ŒãŒç¾ã—ãè¦‹ãˆã‚‹",
        q9_world_line: "ã‚ãªãŸã®æ˜Ÿã‚’è¦‹ä¸Šã’ã¦ãã ã•ã„",

        q10_message_lines: [
          "ğŸ‡ã‹ã¹ã‚‹ã­ãµã‚‰ã‚“ã•ã‚“ï¼",
          "å¿ƒã‹ã‚‰ãŠèª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼",
          "ã“ã‚Œã‹ã‚‰ã‚‚ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ğŸ’•ğŸ‚âœ¨"
        ],

        q11_pairing: "ã“ã®ä¸–ç•Œã®é£Ÿã¹ç‰©ã¯ã™ã¹ã¦",
        q12_storage: "ã‚ãªãŸã®å¿ƒã®å¥¥",
        q13_craft: "æ¥­ç•Œã®ç§˜å¯†ã§ã™ï¼ğŸ˜†",

        display_en: "YOUR STAR MOMENT",
        tagline: "A CELEBRATION JUST FOR YOU",
        openCount: 0
      }
    ];

    let currentIndex = 0;
    let activeWineIndex = null;
    let homeIsVisible = true;
    let interactionLocked = false;
    let revisitCountKeyPrefix = "wine-open-count-";

    const homeScreen = document.getElementById("home-screen");
    const winexpScreen = document.getElementById("winexp-screen");
    const bottleStrip = document.getElementById("bottle-strip");
    const pagerDots = document.getElementById("pager-dots");
    const qrToggle = document.getElementById("qr-toggle");
    const qrOverlay = document.getElementById("qr-overlay");
    const qrClose = document.getElementById("qr-close");
    const overlayBottleList = document.getElementById("overlay-bottle-list");

    const winexpTitleJp = document.getElementById("winexp-title-jp");
    const winexpTitleEn = document.getElementById("winexp-title-en");
    const winexpTagline = document.getElementById("winexp-tagline");
    const basicInfoSection = document.getElementById("basic-info-section");
    const worldSection = document.getElementById("world-section");
    const worldLinePrimary = document.getElementById("world-line-primary");
    const worldLineSecondary = document.getElementById("world-line-secondary");
    const messageWax = document.getElementById("message-wax");
    const messageCard = document.getElementById("message-card");
    const messageBody = document.getElementById("message-body");
    const accordionList = document.getElementById("accordion-list");
    const winexpBgLayer = document.getElementById("winexp-bg-layer");
    const nightStars = document.getElementById("night-stars");
    const homeButton = document.getElementById("home-button");
    const revisitBadge = document.getElementById("revisit-badge");
    const revisitText = document.getElementById("revisit-text");

    const wineTitleBubble = document.getElementById("wine-title-bubble");
    const wineTitleBubbleText = document.getElementById("wine-title-bubble-text");
    const winexpBottleHero = document.getElementById("winexp-bottle-hero");
    const winexpBottleHeroImg = document.getElementById("winexp-bottle-hero-img");
    const pawButton = document.getElementById("paw-button");

    const bgmAudio = document.getElementById("bgm-audio");
    const bgmVolumeSlider = document.getElementById("bgm-volume");
    const seWine1 = document.getElementById("se-wine1");
    const nyaAudio = document.getElementById("nya-audio");

    /* ãƒ›ãƒ¼ãƒ ãƒœãƒˆãƒ«ï¼š3æœ¬ï¼‹å·¦å³ã®è–„ã„ãƒœãƒˆãƒ« */
    function renderHomeBottles() {
      bottleStrip.innerHTML = "";

      const visibleMain = 3;
      if (wines.length <= visibleMain) {
        // å˜ç´”ã«3æœ¬ã¾ã§è¡¨ç¤º
        const start = 0;
        const end = wines.length;
        for (let i = start; i < end; i++) {
          appendBottleItem(i, false, false);
        }
        return;
      }

      // ä¸­å¤®3æœ¬ã‚’è¨ˆç®—
      let start = currentIndex - 1;
      let end = currentIndex + 2;
      if (start < 0) {
        start = 0;
        end = start + visibleMain;
      }
      if (end > wines.length) {
        end = wines.length;
        start = end - visibleMain;
      }

      const leftIndex = start - 1;
      const rightIndex = end;

      // å·¦ã«è–„ã„ãƒœãƒˆãƒ«
      if (leftIndex >= 0) {
        appendBottleItem(leftIndex, true, true);
      }

      // ä¸­å¤®3æœ¬
      for (let i = start; i < end; i++) {
        appendBottleItem(i, false, false);
      }

      // å³ã«è–„ã„ãƒœãƒˆãƒ«
      if (rightIndex < wines.length) {
        appendBottleItem(rightIndex, true, false);
      }
    }

    function appendBottleItem(i, isSide, isLeftSide) {
      const wine = wines[i];
      const item = document.createElement("div");
      item.className = "bottle-item";
      if (isSide) {
        item.classList.add("bottle-item--side");
      } else if (i === currentIndex) {
        item.classList.add("bottle-item--focused");
      } else {
        item.classList.add("bottle-item--dimmed");
      }

      const wrap = document.createElement("div");
      wrap.className = "bottle-image-wrapper";

      const img = document.createElement("img");
      img.className = "bottle-image";
      img.src = wine.bottleImage;
      img.alt = wine.q1_name;

      const shadow = document.createElement("div");
      shadow.className = "bottle-shadow";

      const reflection = document.createElement("div");
      reflection.className = "bottle-reflection";

      wrap.appendChild(img);
      wrap.appendChild(shadow);
      wrap.appendChild(reflection);

      item.appendChild(wrap);
      bottleStrip.appendChild(item);

      if (isSide) {
        item.addEventListener("click", () => {
          if (!homeIsVisible) return;
          if (isLeftSide) {
            // å·¦å´ â†’ ä¸­å¤®indexã‚’1ã¤å·¦ã¸
            currentIndex = Math.max(0, currentIndex - 1);
          } else {
            // å³å´ â†’ ä¸­å¤®indexã‚’1ã¤å³ã¸
            currentIndex = Math.min(wines.length - 1, currentIndex + 1);
          }
          // ã‚¹ãƒ¯ã‚¤ãƒ—éŸ³ï¼šs1
          try {
            seWine1.currentTime = 0;
            seWine1.play();
          } catch (_) {}
          renderHomeBottles();
        });
      } else {
        item.addEventListener("click", () => {
          if (homeIsVisible) {
            handleBottleTap(i, item);
          }
        });
      }
    }

    function handleBottleTap(index, bottleElement) {
      activeWineIndex = index;

      bottleElement.style.transition = "filter 0.12s var(--transition-standard)";
      bottleElement.style.filter = "brightness(0.92)";
      setTimeout(() => {
        bottleElement.style.filter = "";
      }, 120);

      setTimeout(() => {
        homeScreen.style.transition = "filter 0.65s var(--transition-soft)";
        homeScreen.style.filter = "blur(10px) brightness(0.85)";
        showWineXp(index);
      }, 150);
    }

    function showWineXp(index) {
      homeIsVisible = false;
      homeScreen.classList.add("screen--hidden");
      homeScreen.classList.remove("screen--active");

      winexpScreen.classList.remove("screen--hidden");
      winexpScreen.classList.add("screen--active");
      document.body.style.overflow = "hidden";

      homeButton.classList.add("home-button--visible");

      const wine = wines[index];

      const key = revisitCountKeyPrefix + wine.id;
      const prevCount = parseInt(localStorage.getItem(key) || "0", 10);
      const newCount = prevCount + 1;
      localStorage.setItem(key, String(newCount));
      wine.openCount = newCount;

      interactionLocked = true;
      winexpScreen.classList.add("winexp-screen--locked-interaction");
      setTimeout(() => {
        interactionLocked = false;
        winexpScreen.classList.remove("winexp-screen--locked-interaction");
      }, 2500);

      winexpTitleJp.textContent = wine.q1_name || "";
      winexpTitleEn.textContent = wine.display_en || "";

      if (wine.tagline) {
        wineTitleBubble.style.display = "inline-flex";
        wineTitleBubbleText.textContent = wine.tagline;
      } else {
        wineTitleBubble.style.display = "none";
      }

      if (wine.bottleImage) {
        winexpBottleHero.style.display = "flex";
        winexpBottleHeroImg.src = wine.bottleImage;
        winexpBottleHeroImg.alt = wine.q1_name || "";
      } else {
        winexpBottleHero.style.display = "none";
      }

      // wine4 ã®ã¨ãã ã‘è‚‰çƒè¡¨ç¤º
      if (wine.id === "wine4") {
        pawButton.style.display = "inline-flex";
      } else {
        pawButton.style.display = "none";
      }

      renderBasicInfo(wine);

      basicInfoSection.classList.add("winexp-section--has-image");
      let styleEl = document.getElementById("basic-info-bg-style");
      if (!styleEl) {
        styleEl = document.createElement("style");
        styleEl.id = "basic-info-bg-style";
        document.head.appendChild(styleEl);
      }
      styleEl.textContent = `
        #basic-info-section::before {
          background-image: url("${wine.bottleImage}");
        }
      `;

      worldLinePrimary.textContent = wine.q8_world_phrase || "";
      worldLineSecondary.textContent = wine.q9_world_line || "";
      worldSection.classList.remove("world-section--active");
      worldLinePrimary.classList.remove("world-line-primary--visible");
      worldLineSecondary.classList.remove("world-line-secondary--visible");

      setupMessage(wine);
      renderAccordions(wine);
      updateNightEffects();
      updateRevisitBadge(wine);

      winexpScreen.scrollTop = 0;
      setupScrollAnimations();

      // ã©ã®ãƒ¯ã‚¤ãƒ³ã§ã‚‚ s1 ã‚’å†ç”Ÿ
      try {
        seWine1.currentTime = 0;
        seWine1.play();
      } catch (_) {}
    }

    function renderBasicInfo(wine) {
      basicInfoSection.innerHTML = "";

      const blocks = [
        { label: "Wine", value: wine.q1_name },
        { label: "Producer", value: wine.q2_producer },
        { label: "Origin", value: wine.q3_origin },
        { label: "Variety", value: wine.q4_variety },
        // Style â†’ Rank
        { label: "Rank", value: wine.q6_style },
        { label: "Vintage", value: wine.q5_vintage },
        { label: "Alcohol", value: wine.q7_alcohol }
      ];

      blocks.forEach((b, idx) => {
        if (!b.value) return;
        const block = document.createElement("div");
        block.className = "info-block";
        block.style.transitionDelay = `${0.2 * idx}s`;

        const label = document.createElement("div");
        label.className = "info-label";
        label.textContent = b.label;

        const value = document.createElement("div");
        value.className = "info-value";
        value.textContent = b.value;

        block.appendChild(label);
        block.appendChild(value);
        basicInfoSection.appendChild(block);
      });
    }

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼šè¡Œæ•°ã«å¿œã˜ã¦å¢—ãˆã‚‹
    function setupMessage(wine) {
      messageWax.classList.remove("message-wax--visible");
      messageCard.classList.remove("message-card--open");

      messageBody.innerHTML = "";

      setTimeout(() => {
        messageWax.classList.add("message-wax--visible");
      }, 600);

      let opened = false;
      const onWaxClick = () => {
        if (opened || interactionLocked) return;
        opened = true;

        messageWax.style.transform = "scale(0.94) translateY(3px)";
        setTimeout(() => {
          messageWax.style.transform = "scale(0.98) translateY(1px)";
        }, 200);

        setTimeout(() => {
          messageCard.classList.add("message-card--open");

          const msgLines = wine.q10_message_lines || [];
          const baseDelay = 200;

          msgLines.forEach((text, idx) => {
            const lineEl = document.createElement("div");
            lineEl.className = "message-line";
            lineEl.textContent = text;
            messageBody.appendChild(lineEl);

            setTimeout(() => {
              lineEl.classList.add("message-line--visible");
            }, baseDelay + idx * 350);
          });

        }, 400);
      };

      messageWax.onclick = onWaxClick;
    }

    function renderAccordions(wine) {
      accordionList.innerHTML = "";

      const accData = [
        { icon: "ğŸ½", title: "Pairing", content: wine.q11_pairing },
        { icon: "ğŸŒ™", title: "Storage", content: wine.q12_storage },
        { icon: "ğŸŒŠ", title: "Craft", content: wine.q13_craft }
      ];

      accData.forEach((item) => {
        if (!item.content) return;
        const accItem = document.createElement("div");
        accItem.className = "accordion-item";

        const header = document.createElement("div");
        header.className = "accordion-header";

        const labelWrap = document.createElement("div");
        labelWrap.className = "accordion-label-wrap";

        const iconEl = document.createElement("div");
        iconEl.className = "accordion-icon";
        iconEl.textContent = item.icon;

        const titleEl = document.createElement("div");
        titleEl.className = "accordion-title";
        titleEl.textContent = item.title;

        labelWrap.appendChild(iconEl);
        labelWrap.appendChild(titleEl);

        const arrow = document.createElement("div");
        arrow.className = "accordion-arrow";
        arrow.textContent = ">";

        header.appendChild(labelWrap);
        header.appendChild(arrow);

        const body = document.createElement("div");
        body.className = "accordion-body";

        const text = document.createElement("div");
        text.className = "accordion-text";
        text.textContent = item.content;

        body.appendChild(text);

        accItem.appendChild(header);
        accItem.appendChild(body);
        accordionList.appendChild(accItem);

        header.addEventListener("click", () => {
          const isOpen = accItem.classList.contains("accordion-item--open");
          if (isOpen) {
            accItem.classList.remove("accordion-item--open");
          } else {
            accItem.classList.add("accordion-item--open");
          }
        });
      });
    }

    function setupScrollAnimations() {
      const infoBlocks = Array.from(basicInfoSection.querySelectorAll(".info-block"));

      const handleScroll = () => {
        const vh = winexpScreen.clientHeight;

        infoBlocks.forEach((block, idx) => {
          const rect = block.getBoundingClientRect();
          const offset = rect.top;
          if (offset < vh - 90) {
            setTimeout(() => {
              block.classList.add("info-block--visible");
            }, idx * 200);
          }
        });

        const worldRect = worldSection.getBoundingClientRect();
        if (worldRect.top < vh - 140) {
          worldSection.classList.add("world-section--active");
          setTimeout(() => {
            worldLinePrimary.classList.add("world-line-primary--visible");
          }, 150);
          setTimeout(() => {
            worldLineSecondary.classList.add("world-line-secondary--visible");
          }, 650);
        }
      };

      winexpScreen.removeEventListener("scroll", handleScroll);
      winexpScreen.addEventListener("scroll", handleScroll);
      handleScroll();
    }

    function isNightTime() {
      const h = new Date().getHours();
      return h >= 22 || h < 5;
    }

    function updateNightEffects() {
      if (isNightTime()) {
        nightStars.classList.add("night-stars--visible");
        winexpBgLayer.style.filter = "brightness(0.9)";
      } else {
        nightStars.classList.remove("night-stars--visible");
        winexpBgLayer.style.filter = "brightness(1)";
      }
    }

    function updateRevisitBadge(wine) {
      const count = wine.openCount || 0;
      if (count <= 1) {
        revisitBadge.classList.remove("revisit-badge--visible");
        return;
      }

      let starCount = Math.min(count, 5);
      let stars = "â˜…".repeat(starCount);
      revisitBadge.querySelector(".revisit-star").textContent = stars;

      let extraLine = "";
      if (count >= 3 && count < 6) {
        extraLine = "GROWING MEMORY";
      } else if (count >= 6 && count < 10) {
        extraLine = "YOUR WINE KEEPS GROWING";
      } else if (count >= 10) {
        extraLine = "THANK YOU FOR LOVING THIS WINE";
      } else {
        extraLine = "SECOND POUR";
      }
      revisitText.textContent = extraLine;

      revisitBadge.classList.add("revisit-badge--visible");
    }

    function goHome() {
      if (homeIsVisible) return;
      homeIsVisible = true;
      winexpScreen.classList.add("screen--hidden");
      winexpScreen.classList.remove("screen--active");

      homeScreen.classList.remove("screen--hidden");
      homeScreen.classList.add("screen--active");
      document.body.style.overflow = "hidden";

      homeButton.classList.remove("home-button--visible");
      homeScreen.style.filter = "none";
    }

    homeButton.addEventListener("click", () => {
      homeScreen.style.transition = "transform 0.6s var(--transition-standard), opacity 0.6s var(--transition-standard)";
      homeScreen.style.transform = "translateY(0)";
      goHome();
    });

    function openQrOverlay() {
      qrOverlay.classList.add("overlay--open");
    }

    function closeQrOverlay() {
      qrOverlay.classList.remove("overlay--open");
    }

    qrToggle.addEventListener("click", () => {
      openQrOverlay();
    });
    qrClose.addEventListener("click", () => {
      closeQrOverlay();
    });
    qrOverlay.addEventListener("click", (e) => {
      if (e.target === qrOverlay) {
        closeQrOverlay();
      }
    });

    function renderOverlayBottles() {
      overlayBottleList.innerHTML = "";

      wines.forEach((wine) => {
        const item = document.createElement("div");
        item.className = "overlay-bottle";

        const imgWrap = document.createElement("div");
        imgWrap.className = "overlay-bottle-img-wrap";

        const img = document.createElement("img");
        img.className = "overlay-bottle-img";
        img.src = wine.bottleImage;
        img.alt = wine.q1_name;

        const shadow = document.createElement("div");
        shadow.className = "overlay-bottle-shadow";

        imgWrap.appendChild(img);
        imgWrap.appendChild(shadow);

        const nameEl = document.createElement("div");
        nameEl.className = "overlay-name";
        nameEl.textContent = wine.q1_name;

        const qrArea = document.createElement("div");
        qrArea.className = "overlay-qr-area";

        const qrCanvasWrap = document.createElement("div");
        qrCanvasWrap.className = "overlay-qr-canvas-wrap";

        const qrCanvas = document.createElement("canvas");
        qrCanvas.width = 128;
        qrCanvas.height = 128;
        qrCanvasWrap.appendChild(qrCanvas);

        const qrUrl = `${BASE_URL}?wine=${encodeURIComponent(wine.id)}`;
        const qr = new QRious({
          element: qrCanvas,
          value: qrUrl,
          size: 120,
          level: "H",
          background: "transparent",
          foreground: "#e5e7eb"
        });

        const actionRow = document.createElement("div");
        actionRow.className = "overlay-qr-action-row";

        const previewBtn = document.createElement("div");
        previewBtn.className = "overlay-qr-icon";
        previewBtn.textContent = "QR";

        const saveBtn = document.createElement("div");
        saveBtn.className = "overlay-qr-icon";
        saveBtn.textContent = "Save";

        previewBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          const dataUrl = qrCanvas.toDataURL("image/png");
          const win = window.open();
          if (win) {
            win.document.write('<img src="' + dataUrl + '" style="width:100%;height:auto;"/>');
          }
        });

        saveBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          const dataUrl = qrCanvas.toDataURL("image/png");
          const a = document.createElement("a");
          a.href = dataUrl;
          a.download = `${wine.id}_qr.png`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
        });

        actionRow.appendChild(previewBtn);
        actionRow.appendChild(saveBtn);

        qrArea.appendChild(qrCanvasWrap);
        qrArea.appendChild(actionRow);

        item.appendChild(imgWrap);
        item.appendChild(nameEl);
        item.appendChild(qrArea);

        overlayBottleList.appendChild(item);
      });
    }

    function setupBgm() {
      bgmAudio.volume = parseFloat(bgmVolumeSlider.value || "0.5");

      bgmVolumeSlider.addEventListener("input", () => {
        bgmAudio.volume = parseFloat(bgmVolumeSlider.value || "0.5");
      });

      const tryStart = () => {
        bgmAudio.play().catch(() => {});
        document.removeEventListener("click", tryStart);
        document.removeEventListener("touchstart", tryStart);
      };
      document.addEventListener("click", tryStart);
      document.addEventListener("touchstart", tryStart);
    }

    function getWineIdFromQuery() {
      const params = new URLSearchParams(window.location.search);
      return params.get("wine");
    }

    function openWineFromQueryIfNeeded() {
      const wineId = getWineIdFromQuery();
      if (!wineId) return;
      const idx = wines.findIndex(w => w.id === wineId);
      if (idx >= 0) {
        currentIndex = idx;
        renderHomeBottles();
        setTimeout(() => {
          showWineXp(idx);
        }, 200);
      }
    }

    // è‚‰çƒãƒœã‚¿ãƒ³ï¼šwine4 å°‚ç”¨
    pawButton.addEventListener("click", () => {
      try {
        nyaAudio.currentTime = 0;
        nyaAudio.play();
      } catch (_) {}
    });

    function init() {
      renderHomeBottles();
      renderOverlayBottles();
      updateNightEffects();
      setupBgm();
      openWineFromQueryIfNeeded();
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
